<div class="page-content">
    <div class="content-card">
        <h1 class="page-title">Pinjam ruang</h1>
        <div class="title-underline"></div>

        <!-- Detail Ruangan Section (Above Tabs) -->
        <div class="room-detail-section" *ngIf="selectedRoom">
            <div class="room-layout">
                <!-- Left: Room Images -->
                <div class="room-images">
                    <img [src]="selectedRoom.imageUrl" [alt]="selectedRoom.name" class="main-image">
                    <div class="thumbnail-row">
                        <img [src]="selectedRoom.imageUrl" [alt]="selectedRoom.name" class="thumbnail">
                        <img [src]="selectedRoom.imageUrl" [alt]="selectedRoom.name" class="thumbnail">
                        <img [src]="selectedRoom.imageUrl" [alt]="selectedRoom.name" class="thumbnail">
                        <img [src]="selectedRoom.imageUrl" [alt]="selectedRoom.name" class="thumbnail">
                    </div>
                </div>

                <!-- Right: Room Info -->
                <div class="room-info-container">
                    <h2 class="room-name">{{ selectedRoom.name }}</h2>

                    <div class="room-info-grid">
                        <div class="info-row">
                            <span class="label">Unit pemilik</span>
                            <span class="value">{{ selectedRoom.unit }}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Gedung</span>
                            <span class="value">{{ selectedRoom.gedung }}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Lantai</span>
                            <span class="value">Lantai {{ selectedRoom.floor }}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Lokasi</span>
                            <span class="value">{{ selectedRoom.location }}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Tautan Google Maps</span>
                            <a [href]="selectedRoom.mapsUrl" target="_blank" class="link">Tautan lokasi dapat diakses
                                disini</a>
                        </div>
                        <div class="info-row">
                            <span class="label">Jenis ruang</span>
                            <span class="value">{{ selectedRoom.type }}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Kapasitas</span>
                            <span class="value">{{ selectedRoom.capacity }} orang</span>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="room-description">
                        <h4>Deskripsi ruangan:</h4>
                        <p>{{ selectedRoom.description }}</p>
                    </div>

                    <!-- Facilities -->
                    <div class="room-facilities">
                        <h4>Fasilitas:</h4>
                        <div class="facility-list">
                            <label class="checkbox-label" *ngFor="let facility of selectedRoom.facilities">
                                <input type="checkbox" disabled checked>
                                <span>{{ facility }}</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation (Centered) -->
        <div class="tabs">
            <button class="tab-btn" [class.active]="activeTab === 'form'" (click)="setActiveTab('form')">
                Form peminjaman
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'ketersediaan'"
                (click)="setActiveTab('ketersediaan')">
                Ketersediaan ruang
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'aturan'" (click)="setActiveTab('aturan')">
                Aturan peminjaman
            </button>
        </div>

        <!-- Tab Content: Form Peminjaman -->
        <div class="tab-content" *ngIf="activeTab === 'form'">
            <!-- Penanggung Jawab -->
            <div class="form-group-section">
                <h3 class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path
                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                    </svg>
                    Penanggung jawab
                </h3>

                <div class="form-group">
                    <label>Instansi penanggung jawab <span class="required">*</span></label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="instansi" value="internal" [(ngModel)]="formData.instansi">
                            <span>Internal UII</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="instansi" value="eksternal" [(ngModel)]="formData.instansi">
                            <span>Eksternal UII</span>
                        </label>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="namaPenanggungJawab">Nama penanggung jawab <span class="required">*</span></label>
                        <input type="text" id="namaPenanggungJawab" class="form-input"
                            placeholder="Masukkan nama penanggung jawab acara"
                            [(ngModel)]="formData.namaPenanggungJawab">
                    </div>

                    <div class="form-group">
                        <label for="noWhatsapp">Nomor WhatsApp penanggung jawab <span class="required">*</span></label>
                        <input type="tel" id="noWhatsapp" class="form-input"
                            placeholder="Masukkan nomor whatsapp penanggung jawab" [(ngModel)]="formData.noWhatsapp">
                    </div>
                </div>
            </div>

            <!-- Detail Acara -->
            <div class="form-group-section">
                <h3 class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path
                            d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                    </svg>
                    Detail acara
                </h3>

                <div class="form-group">
                    <label for="namaAcara">Nama acara <span class="required">*</span></label>
                    <input type="text" id="namaAcara" class="form-input" placeholder="Masukkan nama acara"
                        [(ngModel)]="formData.namaAcara">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="jenisAcara">Jenis acara <span class="required">*</span></label>
                        <select id="jenisAcara" class="form-select" [(ngModel)]="formData.jenisAcara">
                            <option value="">Pilih jenis acara</option>
                            <option *ngFor="let jenis of jenisAcaraList" [value]="jenis">{{ jenis }}</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="jumlahPeserta">Jumlah peserta acara <span class="required">*</span></label>
                        <input type="number" id="jumlahPeserta" class="form-input" placeholder="Masukkan jumlah peserta"
                            [(ngModel)]="formData.jumlahPeserta">
                    </div>
                </div>

                <div class="form-group">
                    <label for="deskripsiAcara">Deskripsi acara</label>
                    <textarea id="deskripsiAcara" class="form-textarea" rows="4" placeholder="Masukkan deskripsi acara"
                        [(ngModel)]="formData.deskripsiAcara"></textarea>
                </div>

                <div class="form-group">
                    <label for="fasilitasTambahan">Permintaan fasilitas tambahan</label>
                    <textarea id="fasilitasTambahan" class="form-textarea" rows="3"
                        placeholder="Masukkan permintaan fasilitas tambahan jika dibutuhkan"
                        [(ngModel)]="formData.fasilitasTambahan"></textarea>
                </div>

                <!-- File Upload -->
                <div class="form-group">
                    <label>Dokumen pendukung</label>
                    <div class="upload-section">
                        <div class="upload-area" *ngIf="!uploadedFileName">
                            <input type="file" id="fileUpload" class="file-input"
                                accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" (change)="onFileSelected($event)">
                            <label for="fileUpload" class="upload-label">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                                </svg>
                                <span class="upload-text">Upload</span>
                            </label>
                            <p class="upload-hint">File Maks 10mb<br>Format jpg/jpeg/png/pdf</p>
                        </div>

                        <div class="uploaded-file" *ngIf="uploadedFileName">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                            </svg>
                            <span>{{ uploadedFileName }}</span>
                            <button type="button" class="btn-remove" (click)="removeFile()">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Waktu Acara -->
            <div class="form-group-section">
                <div class="section-title-wrapper">
                    <h3 class="section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                            fill="currentColor">
                            <path
                                d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z" />
                            <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
                        </svg>
                        Waktu acara
                    </h3>

                    <!-- Add More Button - positioned next to title -->
                    <button type="button" class="btn-add-more">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                    </button>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header active">
                        <span>Hari 1</span>
                    </div>
                    <div class="accordion-content">
                        <div class="form-group">
                            <label for="tanggalAcara">Tanggal acara <span class="required">*</span></label>
                            <input type="date" id="tanggalAcara" class="form-input" [(ngModel)]="formData.tanggalAcara">
                        </div>

                        <div class="form-row time-row">
                            <div class="form-group">
                                <label for="jamMulai">Waktu mulai <span class="required">*</span></label>
                                <input type="time" id="jamMulai" class="form-input" [(ngModel)]="formData.jamMulai">
                            </div>

                            <div class="form-group">
                                <label for="jamSelesai">Waktu selesai <span class="required">*</span></label>
                                <input type="time" id="jamSelesai" class="form-input" [(ngModel)]="formData.jamSelesai">
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Pernyataan Checkbox -->
            <div class="form-agreement">
                <label class="agreement-checkbox">
                    <input type="checkbox" [(ngModel)]="formData.agreement">
                    <span class="checkmark"></span>
                    <span class="agreement-text">Saya menyatakan akan mengikuti dan menyetujui aturan dan kebijakan dari
                        peminjaman ruang</span>
                </label>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="onBatal()">Batal</button>
                <button type="button" class="btn btn-primary" (click)="onSubmit()">Pinjam ruang</button>
            </div>
        </div>

        <!-- Tab Content: Ketersediaan Ruang -->
        <div class="tab-content" *ngIf="activeTab === 'ketersediaan'">
            <div class="ketersediaan-header">
                <div class="week-navigation">
                    <button class="btn-nav">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                            fill="currentColor">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </button>
                    <button class="btn-nav">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                            fill="currentColor">
                            <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                        </svg>
                    </button>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <span class="legend-box verified"></span>
                        <span>Sudah dipinjam</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-box pending"></span>
                        <span>Menunggu konfirmasi</span>
                    </div>
                </div>
            </div>

            <!-- Weekly Scheduler Table -->
            <div class="weekly-scheduler-wrapper">
                <table class="weekly-scheduler-table">
                    <thead>
                        <tr>
                            <th class="time-column">Waktu/Hari</th>
                            <th *ngFor="let day of weekDays" class="day-header">{{ day }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let slot of ketersediaanTimeSlots">
                            <td class="time-cell">{{ slot.label }}</td>

                            <ng-container *ngFor="let day of weekDays; let dayIndex = index">
                                <td class="schedule-cell"
                                    *ngIf="!getWeeklyBooking(dayIndex, slot.hour) || isFirstSlotOfWeeklyBooking(dayIndex, slot.hour)"
                                    [class.has-booking]="getWeeklyBooking(dayIndex, slot.hour)"
                                    [class.verified]="getWeeklyBooking(dayIndex, slot.hour)?.status === 'verified'"
                                    [class.pending]="getWeeklyBooking(dayIndex, slot.hour)?.status === 'pending'"
                                    [attr.rowspan]="isFirstSlotOfWeeklyBooking(dayIndex, slot.hour) ? getWeeklyBookingRowSpan(getWeeklyBooking(dayIndex, slot.hour)!) : null">

                                    <div class="booking-info" *ngIf="getWeeklyBooking(dayIndex, slot.hour) as booking">
                                        <div class="booking-time">
                                            {{ booking.startHour.toString().padStart(2, '0') }}.00 - {{
                                            booking.endHour.toString().padStart(2, '0') }}.00 WIB
                                        </div>
                                        <div class="booking-event">{{ booking.eventType }}</div>
                                        <div class="booking-unit">{{ booking.unit }}</div>
                                    </div>
                                </td>
                            </ng-container>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab Content: Aturan Peminjaman -->
        <div class="tab-content" *ngIf="activeTab === 'aturan'">
            <div class="aturan-content">
                <h3 class="aturan-title">Aturan peminjaman ruangan (Umum)</h3>
                <p class="aturan-desc">
                    Peminjaman ruangan harus dilakukan melalui sistem pemesanan yang telah ditentukan sebelumnya. Dengan
                    mematuhi aturan-aturan ini, diharapkan setiap pengguna dapat memberikan kontribusi positif dalam
                    menjaga ruangan dan fasilitasnya.
                </p>

                <div class="aturan-item">
                    <h4>Informasi dan Peralatan:</h4>
                    <p>Semua fasilitas dan peralatan yang disediakan dalam ruangan harus digunakan dengan hati-hati dan
                        sesuai dengan petunjuk penggunaan yang berlaku. Peminjam <strong>wajib melaporkan</strong>
                        segala kerusakan atau masalah yang timbul selama penggunaan ruangan.</p>
                </div>

                <div class="aturan-item">
                    <h4>Fasilitas dan Peralatan:</h4>
                    <p>Semua fasilitas dan peralatan yang disediakan dalam ruangan harus digunakan dengan hati-hati dan
                        sesuai dengan petunjuk penggunaan yang berlaku. Peminjam <strong>wajib melaporkan</strong>
                        segala kerusakan atau masalah yang timbul selama penggunaan ruangan.</p>
                </div>

                <div class="aturan-item">
                    <h4>Waktu Penggunaan:</h4>
                    <p>Waktu penggunaan ruangan harus sesuai dengan yang telah dijadwalkan dalam pemesanan. Peminjam
                        diharapkan untuk tiba tepat waktu dan meninggalkan ruangan pada waktu yang telah ditentukan.</p>
                </div>

                <div class="aturan-item">
                    <h4>Tujuan Penggunaan:</h4>
                    <p>Ruangan hanya boleh digunakan sesuai dengan tujuan yang telah disepakati pada saat pemesanan.
                        Penggunaan ruangan untuk kegiatan yang melanggar hukum atau norma-norma etika tidak
                        diperbolehkan.</p>
                </div>

                <div class="aturan-item">
                    <h4>Kerusakan dan Kehilangan:</h4>
                    <p>Peminjam bertanggung jawab penuh atas segala kerusakan atau kehilangan fasilitas, peralatan, atau
                        properti lain yang terdapat dalam ruangan selama penggunaan. Biaya perbaikan atau penggantian
                        akan ditanggung oleh peminjam jika ditemukan adanya kerusakan.</p>
                </div>

                <div class="aturan-item">
                    <h4>Penalti dan Sanksi:</h4>
                    <p>Pelanggaran terhadap aturan peminjaman ruangan dapat mengakibatkan sanksi, termasuk pembatasan
                        akses untuk peminjaman selanjutnya.</p>
                </div>

                <div class="aturan-item">
                    <h4>Pemberitahuan keterlambatan dan pembatalan:</h4>
                    <p>Jika terjadi keterlambatan atau pembatalan, peminjam diharapkan memberikan pemberitahuan secepat
                        mungkin untuk memberikan kesempatan kepada pihak lain yang membutuhkan ruangan.</p>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="onBatal()">Batal</button>
                <button type="button" class="btn btn-primary" (click)="onSubmit()">Pinjam ruang</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" *ngIf="showConfirmModal" (click)="onCancelConfirm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
            </svg>
        </div>

        <h2 class="modal-title">Apakah Anda yakin data pengajuan sudah benar</h2>
        <p class="modal-subtitle">Periksa kembali apabila Anda belum yakin data sudah benar</p>

        <div class="modal-info">
            <div class="info-row">
                <span class="info-label">Tarif peminjaman</span>
                <span class="info-value">: {{ formatRupiah(tarifPerJam) }}/jam</span>
            </div>
            <div class="info-row">
                <span class="info-label">Durasi peminjaman</span>
                <span class="info-value">: {{ durasiJam }} jam</span>
            </div>
            <div class="info-row">
                <span class="info-label">Total pembayaran</span>
                <span class="info-value">: {{ formatRupiah(totalPembayaran) }}</span>
            </div>
        </div>

        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" (click)="onCancelConfirm()">Kembali</button>
            <button type="button" class="btn btn-primary" (click)="onConfirmSubmit()">Ya, saya yakin</button>
        </div>
    </div>
</div>